# toir_tra_index_works
# Автоматическая сортировка файлов по папкам на основе индекса

## 1. Назначение скрипта

Скрипт предназначен для автоматической организации файлов в папке. Он сканирует указанную директорию, находит файлы, имена которых содержат специальный индекс (например, `I.7.5-00-1G`), и на основе этого индекса создает именованные папки, после чего перемещает в них соответствующие файлы.

Это позволяет быстро сгруппировать десятки и сотни файлов по проектным кодам работ.

## 2. Логика работы

1.  **Запрос папки**: При запуске скрипт открывает стандартное системное окно, в котором пользователь должен указать папку для сортировки.

2.  **Группировка файлов**: Скрипт рекурсивно обходит все подпапки и находит все файлы. Из имени каждого файла он пытается извлечь **ключ для группировки** с помощью регулярного выражения. 
    -   Примеры ключей: `I.7.5-00-1G`, `I.12.2b-00-2M`, `II.2.6-00-C`.
    -   Все файлы с одинаковым ключом объединяются в одну группу.

3.  **Определение имени папки и перемещение**:
    -   Скрипт проверяет, содержит ли ключ группировки специальный флаг `-C-`.
    -   **Случай 1: Ключ содержит `-C-`** (например, `II.2.6-00-C`)
        -   Имя папки формируется **напрямую из ключа**.
        -   Поиск суффикса в `TZ.xlsx` **не производится**.
        -   Пример имени папки: `II.2.6-00-C`.
    -   **Случай 2: Ключ НЕ содержит `-C-`** (например, `I.7.5-00-1G`)
        -   Для этого случая скрипт ищет **суффикс** в файле `Template/TZ.xlsx` (лист `gen_cl`), сопоставляя индекс из ключа (колонка B) со значением для папки (колонка J).
        -   Имя папки формируется по шаблону: `<КлючГруппировки>_<Суффикс из TZ.xlsx>`.
        -   Пример имени папки: `I.7.5-00-1G_KBV`.
    -   **Общие правила для папок**:
        -   Имя папки всегда создается с использованием латинских букв (кириллица в ключе автоматически транслитерируется).
        -   Скрипт создает папку внутри исходной директории.
        -   Все файлы из соответствующей группы перемещаются в созданную папку.

4.  **Завершение**: После обработки всех групп файлов скрипт выводит в консоль сообщение о завершении работы.

## 3. Входы и выходы

**Вход**:
-   **Папка с файлами**: Директория, содержащая файлы для сортировки (например, `.../CT-DR-B-LP-BVS16-I.7.5-00-1G-20250818-00_All.pdf`).
-   **Файл-справочник**: `Template/TZ.xlsx`.
    -   **Лист**: `gen_cl`.
    -   **Колонка B**: Содержит индексы для поиска (`I.7.5`, `I.12.2б`).
    -   **Колонка J**: Содержит суффиксы для имен папок (`KBV`, `ENK`).

**Выход**:
-   Внутри выбранной папки создаются новые подпапки с именами вида `I.7.5-00-1G_KBV`.
-   Исходные файлы перемещаются в эти новые папки.

## 4. Использование

### Требования
Убедитесь, что у вас установлен `openpyxl`:
```bash
pip install openpyxl
```

### Запуск

Запустите скрипт из корневой папки проекта:
```bash
python toir_tra_index_works.py
```
После запуска появится окно для выбора папки, которую нужно отсортировать.