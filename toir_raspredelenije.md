# toir_raspredelenije
# Автоматическое распределение и архивация файлов отчетов

## 1. Назначение скрипта

Скрипт автоматизирует процесс распределения финальных отчетов (`*_All.pdf`) по нескольким папкам-архивам, а также создает и перемещает zip-архив с исходными материалами отчета.

Он работает по принципу "одна папка - один отчет", обрабатывая подпапки в указанной исходной директории (`INBOX_DIR`).

## 2. Логика работы

Скрипт выполняет следующие шаги:

1.  **Чтение настроек**: Скрипт считывает все рабочие пути из секции `=== НАСТРОЙКИ ПУТЕЙ ===` в самом начале файла.

2.  **Сканирование `INBOX_DIR`**: Скрипт ищет подпапки внутри директории, указанной в переменной `INBOX_DIR`.

3.  **Обработка каждой папки**: Для каждой найденной подпапки выполняется следующая логика:
    -   **Поиск файла-триггера**: Внутри папки ищется уникальный файл, имя которого заканчивается на `_All.pdf`. Если такого файла нет или их несколько, папка пропускается.
    -   **Разбор имени файла**: Из имени найденного PDF-файла (например, `CT-DR-B-LP-BVS15-...-20250814-02_All.pdf`) извлекаются ключевые данные:
        -   **Год**: `2025`
        -   **Месяц**: `08` (Август)
        -   **Part**: `LP` (может быть `LP` или `CS`)
        -   **Имя объекта**: `BVS15`
    -   **Нормализация имени объекта**: Если имя объекта соответствует шаблону `BVS0[1-9]` (например, `BVS05`), оно приводится к стандартному виду (`BVS5`). Это позволяет складывать файлы для `BVS05` и `BVS5` в одну и ту же папку назначения. Имена `BVS10`, `BVS11` и т.д. не изменяются.
    -   **Простое копирование PDF**: Файл `*_All.pdf` копируется в две директории, указанные в `NOTES_DIR` и `TRA_GST_DIR`.
    -   **Копирование PDF по сложному пути**: Тот же `*_All.pdf` копируется в структурированную директорию, которая строится относительно пути `DEST_ROOT_DIR`:
        -   `{DEST_ROOT_DIR}/{Год}/{Номер.Месяц}/{Part}/pdf/{Имя объекта}/`
        -   Пример: `D:/Work/raspredelenije/2025/08.August/LP/pdf/BVS15/`
    -   **Архивация и перемещение**: 
        -   **Вся исходная подпапка** целиком архивируется в `.zip` архив во временную папку `TEMP_ARCHIVE_DIR`.
        -   Созданный `.zip` архив перемещается в структурированную директорию для исходников, построенную относительно `DEST_ROOT_DIR`:
            -   `{DEST_ROOT_DIR}/{Год}/{Номер.Месяц}/{Part}/Native/{Имя объекта}/`
            -   Пример: `D:/Work/raspredelenije/2025/08.August/LP/Native/BVS15/`

4.  **Завершение**: После обработки всех папок скрипт завершает свою работу.

## 3. Настройка и запуск

### 1. Настройка путей

Перед первым запуском откройте файл `toir_raspredelenije.py` и отредактируйте секцию `=== НАСТРОЙКИ ПУТЕЙ ===`. Укажите полные и корректные пути к вашим рабочим директориям.

```python
# === НАСТРОЙКИ ПУТЕЙ ===
# Замените пути на актуальные для вашей системы.
# Используйте r"..." для путей в Windows, чтобы избежать проблем с \.

# 1. Папка, где лежат исходные проекты для обработки
INBOX_DIR = Path(r"test/raspredelenije/00_Inbox")

# 2. Папка для копирования PDF-файлов (примечания)
NOTES_DIR = Path(r"test/raspredelenije/03_Notes")

# 3. Папка для копирования PDF-файлов (трансмиттал)
TRA_GST_DIR = Path(r"test/raspredelenije/04_TRA_GST")

# 4. Корневая папка для создаваемой структуры (Год/Part/pdf и Native)
DEST_ROOT_DIR = Path(r"test/raspredelenije")

# 5. Временная папка для создания архивов
TEMP_ARCHIVE_DIR = Path(r"test/raspredelenije")
```

### 2. Подготовка данных

Поместите папки с отчетами (каждая из которых содержит свой `*_All.pdf`) внутрь директории, которую вы указали в `INBOX_DIR`.

### 3. Запуск

Запустите скрипт из корневой папки проекта:
```bash
python toir_raspredelenije.py
```
Скрипт автоматически выполнит все операции согласно путям, указанным в настройках.