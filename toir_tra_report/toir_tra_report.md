# Скрипт `toir_tra_report.py`

## 1. Назначение

Скрипт предназначен для автоматизации создания отчета "Transmittal" (сопроводительная ведомость) в формате Excel. Он сканирует указанную пользователем папку с документами, извлекает из их имен специальные индексы, находит по этим индексам полные наименования документов и формирует итоговый `.xlsx` файл на основе заданного шаблона.

Утилита имеет графический интерфейс (GUI) для удобства использования.

## 2. Основные возможности

- **Графический интерфейс**: Удобное окно для выбора папки с документами, шаблона компании и дополнительных опций.
- **Автоматический подбор шаблона**: Скрипт пытается угадать нужный шаблон компании (например, "Gastrans (GST)") по имени выбранной папки с документами. Если совпадений нет, устанавливается "Общий (XXX)".
- **Поиск наименований**: Автоматически подставляет полное наименование документа в отчет, находя его по индексу в файле `TZ.xlsx`.
- **Архивация и очистка**: Опционально создает ZIP-архив с исходными документами и может удалять их после успешной архивации.
- **Автоматическое открытие папки**: После завершения работы скрипт сам открывает папку, в которую был сохранен отчет.

## 3. Принцип работы

1.  **Запуск**: Пользователь запускает скрипт, и на экране появляется главное окно.
2.  **Выбор папки**: Пользователь нажимает "Выбрать папку..." и указывает на директорию с документами для отчета.
3.  **Выбор шаблона**: Скрипт автоматически выбирает шаблон на основе имени папки. Пользователь может изменить выбор вручную через выпадающий список.
4.  **Настройка опций**: Пользователь может включить или выключить создание ZIP-архива и удаление исходных файлов.
5.  **Формирование отчета**: После нажатия кнопки "Сформировать трансмиттал" скрипт выполняет основную логику: создает Excel-файл, опционально архивирует вложения и открывает папку с результатом.

## 4. Требования и структура проекта

- **Python**: Версия 3.8 или новее.
- **Библиотеки**: `openpyxl` (`pip install openpyxl`).
- **Структура папок**: Скрипт ожидает определенную структуру папок для корректной работы.

  ```
  .../toir_tra_report/
  ├── toir_tra_report.py       # Сам скрипт
  ├── toir_tra_report.md       # Этот файл
  └── Template/
      ├── TZ.xlsx              # Файл с индексами и наименованиями
      └── template_tra/
          ├── CT-GST-TRA-PRM-Template.xltx
          ├── CT-TER-TRA-PRM-Template.xltx
          └── CT-XXX-TRA-PRM-Template.xltx
  ```

## 5. Использование

1.  Убедитесь, что выполнены все требования и структура папок корректна.
2.  Запустите скрипт (например, `python toir_tra_report.py`).
3.  В открывшемся окне:
    - **Шаг 1**: Нажмите **"Выбрать папку..."**.
    - **Шаг 2**: Убедитесь, что в выпадающем списке **выбран правильный шаблон компании**.
    - **Шаг 3**: При необходимости отметьте галочку **"Создать ZIP-архив..."** и, если нужно, **"Удалить исходные файлы..."**.
    - **Шаг 4**: Нажмите **"Сформировать трансмиттал"**.

## 6. Важные замечания

- **Именование файлов**: Для автоматического заполнения наименования, имя файла должно содержать индекс (например, `MyDoc_IV.1.a_rev2.pdf`). Скрипт распознает следующие расширения: `.pdf`, `.docx`, `.xlsx`, `.xls`, `.dwg`.
- **Файл `TZ.xlsx`**: Является общей "базой знаний" для поиска наименований по индексу.
- **Якорь `FooterAnchor`**: В Excel-шаблонах должен быть именованный диапазон `FooterAnchor`, который указывает на начало "подвала" таблицы. Это необходимо для корректной вставки строк, если количество файлов превышает размер таблицы в шаблоне.
- **Имя выходного файла**: Сгенерированный отчет сохраняется с именем в формате `{Префикс-Шаблона}-{ГГММДД}_{порядковый номер}.xlsx` (например, `CT-GST-TRA-PRM-250903_01.xlsx`).

## 7. План развития (Roadmap)

### Гибкая настройка шаблонов

**Задача:** Дать пользователям (в том числе после компиляции в `.exe`) возможность указывать свою папку с шаблонами и динамически управлять их списком без редактирования исходного кода.

**Предлагаемое решение:**

1.  **Файл настроек пути (`settings.json`):**
    *   Создать файл `settings.json` рядом с исполняемым файлом.
    *   В этом файле будет храниться путь к папке с шаблонами, которую выберет пользователь.
    *   Если файл или путь отсутствует, программа будет использовать папку по умолчанию (`Template/`).

2.  **Изменения в интерфейсе:**
    *   Добавить в верхнее меню программы раздел **"Настройки"**.
    *   В этом меню будет пункт **"Указать папку с шаблонами..."**, который позволит пользователю выбрать папку.

**Результат:**
*   Программа станет полностью настраиваемой для конечного пользователя.
*   Отпадет необходимость в редактировании кода для добавления новых шаблонов.
*   Сохранится простота использования "из коробки" с шаблонами по умолчанию.
