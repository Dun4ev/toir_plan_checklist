# Скрипт `toir_tra_report.py`

## 1. Назначение

Скрипт предназначен для автоматизации создания отчета "Transmittal" (сопроводительная ведомость) в формате Excel. Он сканирует указанную пользователем папку с документами, извлекает из их имен специальные индексы, находит по этим индексам полные наименования документов и формирует итоговый `.xlsx` файл на основе заданного шаблона.

Утилита имеет графический интерфейс (GUI) для удобства использования.

## 2. Основные возможности

- **Графический интерфейс**: Удобное окно для выбора папки, статуса, шаблона и опций.
- **Выбор статуса отправки**: Позволяет выбрать назначение трансмиттала с помощью радио-кнопок, что определяет набор доступных шаблонов.
- **Динамическая загрузка шаблонов**: Меню выбора шаблона компании (GST, TER, XXX) заполняется автоматически на основе файлов, найденных в папке выбранного статуса.
- **Динамическое определение аббревиатур**: Скрипт автоматически сканирует имена файлов-шаблонов (например, `CT-GST-...`) и сам формирует список аббревиатур для поиска. Это устраняет необходимость править код при добавлении новых компаний.
- **Автоматический подбор шаблона**: После выбора статуса, скрипт пытается угадать нужный шаблон компании по имени выбранной папки с документами.
- **Поиск наименований**: Автоматически подставляет полное наименование документа в отчет, находя его по индексу в файле `TZ.xlsx`.
- **Архивация и очистка**: Может автоматически создавать ZIP-архив и удалять исходные файлы.

## 3. Принцип работы

1.  **Запуск**: Пользователь запускает скрипт, и на экране появляется главное окно.
2.  **Выбор папки**: Пользователь нажимает "Выбрать папку..." и указывает на директорию с документами.
3.  **Выбор статуса**: Пользователь выбирает нужный статус отправки с помощью одной из трех радио-кнопок.
4.  **Обновление шаблонов**: Скрипт сканирует соответствующую подпапку с шаблонами (например, `Template/template_tra/izdato_na_pregled_gst/`) и обновляет выпадающий список "Выберите компанию".
5.  **Автовыбор шаблона**: Скрипт анализирует имя папки с документами и автоматически выбирает наиболее подходящий шаблон из списка. Если совпадений нет, выбирается "Общий (XXX)".
6.  **Формирование отчета**: После нажатия кнопки скрипт выполняет основную логику.

## 4. Требования и структура проекта

- **Python**: Версия 3.8 или новее.
- **Библиотеки**: `openpyxl` (`pip install openpyxl`).
- **Структура папок**: Скрипт ожидает, что он находится в своей собственной папке, внутри которой есть папка `Template` с необходимой структурой:
  ```
  .../toir_tra_report/
  ├── toir_tra_report.py       # Сам скрипт
  ├── toir_tra_report.md       # Этот файл
  └── Template/
      ├── TZ.xlsx              # Файл с индексами и наименованиями
      └── template_tra/
          ├── izdato_na_pregled_gst/  # Папка для статуса 1
          │   ├── CT-GST-TRA-PRM-Template.xltx
          │   └── ...
          ├── na_uvid_app/            # Папка для статуса 2
          │   └── ...
          └── za_upotrebu_cmm/        # Папка для статуса 3
              └── ...
  ```

## 5. Использование

1.  Убедитесь, что выполнены все требования и структура папок корректна.
2.  Запустите скрипт из командной строки, находясь в папке `toir_tra_report`:
    ```bash
    python toir_tra_report.py
    ```
3.  В открывшемся окне:
    - **Шаг 1**: Нажмите **"Выбрать папку..."**.
    - **Шаг 2**: Выберите **статус отправки** с помощью радио-кнопки.
    - **Шаг 3**: Убедитесь, что в выпадающем списке **выбран правильный шаблон компании**.
    - **Шаг 4**: Настройте опции архивации.
    - **Шаг 5**: Нажмите **"Сформировать отчет"**.

## 6. Важные замечания

- **Именование файлов**: Для автоматического заполнения наименования, имя файла должно содержать индекс (например, `MyDoc_IV.1.a_rev2.pdf`).
- **Файл `TZ.xlsx`**: Является общей "базой знаний" для всех статусов и шаблонов.
- **Якорь `FooterAnchor`**: В Excel-шаблонах по-прежнему должен быть именованный диапазон `FooterAnchor` для корректной вставки строк.

## 7. План развития (Roadmap)

### Гибкая настройка шаблонов

**Задача:** Дать пользователям (в том числе после компиляции в `.exe`) возможность указывать свою папку с шаблонами и динамически управлять их списком без редактирования исходного кода.

**Предлагаемое решение:**

1.  **Файл настроек пути (`settings.json`):**
    *   Создать файл `settings.json` рядом с исполняемым файлом.
    *   В этом файле будет храниться путь к папке с шаблонами, которую выберет пользователь.
    *   Если файл или путь отсутствует, программа будет использовать папку по умолчанию (`Template/`).

2.  **Изменения в интерфейсе:**
    *   Добавить в верхнее меню программы раздел **"Настройки"**.
    *   В этом меню будет пункт **"Указать папку с шаблонами..."**, который позволит пользователю выбрать папку.

**Результат:**
*   Программа станет полностью настраиваемой для конечного пользователя.
*   Отпадет необходимость в редактировании кода для добавления новых шаблонов.
*   Сохранится простота использования "из коробки" с шаблонами по умолчанию.