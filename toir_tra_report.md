# Скрипт `toir_tra_report.py`

## 1. Назначение

Скрипт предназначен для автоматизации создания отчета "Transmittal" (сопроводительная ведомость) в формате Excel. Он сканирует указанную пользователем папку с документами, извлекает из их имен специальные индексы, находит по этим индексам полные наименования документов и формирует итоговый `.xlsx` файл на основе заданного шаблона.

Утилита имеет графический интерфейс (GUI) для удобства использования.

## 2. Основные возможности

- **Графический интерфейс**: Удобное окно для выбора папки, шаблона и опций.
- **Работа по шаблону**: Создает отчет на основе файлов-шаблонов `.xltx`.
- **Автоматическое определение шаблона**: Пытается угадать нужный шаблон (GST, TER) по имени выбранной папки.
- **Извлечение данных из имен файлов**: Распознает индексы документов (например, `IV.1.a`) прямо из имен файлов.
- **Поиск наименований**: Автоматически подставляет полное наименование документа в отчет, находя его по индексу в специальном файле `TZ.xlsx`.
- **Динамическое добавление строк**: Автоматически вставляет в Excel-файл необходимое количество строк в зависимости от числа найденных документов, сохраняя при этом форматирование "подвала" таблицы.
- **Архивация**: Может автоматически создавать ZIP-архив со всеми обработанными документами.
- **Очистка**: Может удалять исходные файлы после их успешной архивации.
- **Инкрементальное сохранение**: Сохраняет отчет с уникальным именем, добавляя дату и порядковый номер (например, `CT-GST-TRA-PRM-250903_01.xlsx`).

## 3. Принцип работы

1.  **Запуск**: Пользователь запускает скрипт, и на экране появляется главное окно.
2.  **Выбор папки**: Пользователь нажимает "Выбрать папку..." и указывает на директорию, содержащую файлы для отчета (PDF, DOCX, DWG и др.).
3.  **Выбор шаблона**: Скрипт автоматически предлагает шаблон, если в имени папки есть маркеры `GST` или `TER`. В противном случае используется общий шаблон `XXX`, который можно изменить вручную.
4.  **Настройка опций**: Пользователь может выбрать, нужно ли создавать ZIP-архив и удалять ли исходные файлы после этого.
5.  **Формирование отчета**:
    - Скрипт загружает выбранный `.xltx` шаблон.
    - Сканирует указанную папку на наличие файлов с разрешенными расширениями (`.pdf`, `.docx`, `.xlsx`, и т.д.).
    - Загружает данные из `Template/TZ.xlsx` для сопоставления индексов и наименований.
    - Вставляет в таблицу Excel нужное количество строк.
    - Заполняет строки данными: порядковый номер, имя файла и наименование документа (если найден индекс).
    - Сохраняет результат в новый `.xlsx` файл в той же папке, где лежали исходные документы.
    - Если выбрана опция, создает ZIP-архив и/или удаляет исходники.
    - Открывает папку с готовым отчетом.

## 4. Требования

- **Python**: Версия 3.8 или новее.
- **Библиотеки**: Необходимо установить `openpyxl`.
  ```bash
  pip install openpyxl
  ```
- **Структура папок**: Скрипт ожидает определенную структуру файлов:
  ```
  .
  ├── toir_tra_report.py       # Сам скрипт
  ├── Template/
  │   ├── TZ.xlsx              # Файл с индексами и наименованиями
  │   └── template_tra/
  │       ├── CT-GST-TRA-PRM-Template.xltx  # Шаблоны
  │       ├── CT-TER-TRA-PRM-Template.xltx
  │       └── ...
  └── ...
  ```

## 5. Использование

1.  Убедитесь, что выполнены все требования.
2.  Запустите скрипт из командной строки:
    ```bash
    python toir_tra_report.py
    ```
3.  В открывшемся окне:
    - **Шаг 1**: Нажмите **"Выбрать папку..."** и укажите путь к вашим документам.
    - **Шаг 2**: Убедитесь, что выбран правильный **шаблон компании**.
    - **Шаг 3**: Установите галочки **"Создать ZIP-архив"** и **"Удалить исходные файлы"** по необходимости.
    - **Шаг 4**: Нажмите кнопку **"Сформировать отчет"**.
4.  Дождитесь сообщения "Готово!" в статус-баре. Папка с результатом откроется автоматически.

## 6. Важные замечания

- **Именование файлов**: Чтобы наименование документа (`Назив документа`) заполнилось автоматически, имя файла **должно содержать индекс** в формате `РИМСКАЯ.ЦИФРА.ЦИФРАбуква`. Например: `MyDoc_IV.1.a_rev2.pdf`.
- **Файл `TZ.xlsx`**: Этот файл является "базой знаний" для скрипта. Он должен содержать как минимум два столбца: один с индексом, другой — с полным наименованием документа. Скрипт очень гибко ищет индекс в строке, а затем ищет наименование в последующих ячейках той же строки.
- **Шаблоны `.xltx`**: Шаблоны должны содержать именованный диапазон (якорь) с именем `FooterAnchor` в той строке, где начинается "подвал" таблицы. Это позволяет скрипту корректно вставлять строки, не ломая структуру документа.