# toir_tra_index_works
# Автоматическая сортировка файлов по папкам на основе индекса

## 1. Назначение скрипта

Скрипт предназначен для автоматической организации файлов в папке. Он сканирует указанную директорию, находит файлы, имена которых содержат специальный индекс (например, `I.7.5-00-1G`), и на основе этого индекса создает именованные папки, после чего перемещает в них соответствующие файлы.

Это позволяет быстро сгруппировать десятки и сотни файлов по проектным кодам работ.

## 2. Логика работы

1.  **Запрос папки**: При запуске скрипт открывает стандартное системное окно, в котором пользователь должен указать папку для сортировки.

2.  **Группировка файлов**: Скрипт рекурсивно обходит все подпапки и находит все файлы. Из имени каждого файла он пытается извлечь **ключ для группировки** с помощью регулярного выражения. 
    -   Пример ключа: `I.7.5-00-1G` или `I.12.2b-00-2M`.
    -   Все файлы с одинаковым ключом объединяются в одну группу.

3.  **Поиск суффикса в справочнике**: Для каждой группы файлов скрипт выполняет поиск в файле `Template/TZ.xlsx`.
    -   Он извлекает из ключа **индекс для поиска** (например, `I.7.5` из `I.7.5-00-1G`).
    -   Открывает лист `gen_cl`.
    -   Ищет найденный индекс в колонке **B**.
    -   Если совпадение найдено, он забирает значение из колонки **J** из той же строки. Это значение используется как суффикс для имени папки (например, `KBV`).
    -   **Важно**: Поиск поддерживает транслитерацию. Если в имени файла индекс `I.12.2b` (с латинской `b`), а в справочнике `I.12.2б` (с кириллической `б`), скрипт все равно найдет совпадение.

4.  **Создание папки и перемещение файлов**:
    -   Имя новой папки формируется по шаблону: `<КлючГруппировки>_<Суффикс>`.
        -   Пример: `I.7.5-00-1G_KBV`.
    -   **Важно**: Имя папки всегда создается с использованием латинских букв. Если в ключе группировки была кириллическая буква (например, `б`), она будет заменена на латинский аналог (`b`).
    -   Скрипт создает эту папку внутри исходной директории, которую выбрал пользователь.
    -   Все файлы из группы перемещаются в созданную папку.

5.  **Завершение**: После обработки всех групп файлов скрипт выводит в консоль сообщение о завершении работы.

## 3. Входы и выходы

**Вход**:
-   **Папка с файлами**: Директория, содержащая файлы для сортировки (например, `.../CT-DR-B-LP-BVS16-I.7.5-00-1G-20250818-00_All.pdf`).
-   **Файл-справочник**: `Template/TZ.xlsx`.
    -   **Лист**: `gen_cl`.
    -   **Колонка B**: Содержит индексы для поиска (`I.7.5`, `I.12.2б`).
    -   **Колонка J**: Содержит суффиксы для имен папок (`KBV`, `ENK`).

**Выход**:
-   Внутри выбранной папки создаются новые подпапки с именами вида `I.7.5-00-1G_KBV`.
-   Исходные файлы перемещаются в эти новые папки.

## 4. Использование

### Требования
Убедитесь, что у вас установлен `openpyxl`:
```bash
pip install openpyxl
```

### Запуск

Запустите скрипт из корневой папки проекта:
```bash
python toir_tra_index_works.py
```
После запуска появится окно для выбора папки, которую нужно отсортировать.
